# 系统设置功能 - 快速测试指南

## 📋 测试前准备

### ✅ 第1步：执行数据库脚本

**打开DataGrip或MySQL命令行**，执行：

```bash
D:\code\supermarket-system\sql\system_settings.sql
```

**验证**：
```sql
-- 查看系统配置表
SELECT * FROM supermarket_db.system_config;

-- 查看用户配置表
SELECT * FROM supermarket_db.user_config;
```

应该能看到7条系统配置和3条用户配置记录。

---

### ✅ 第2步：重启后端

**在IDEA中**：
1. 点击红色方块停止按钮
2. 重新运行 `SupermarketApplication` 主类

**或命令行**：
```bash
cd D:\code\supermarket-system\supermarket-backend
mvn clean install
mvn spring-boot:run
```

**等待启动完成**，看到：
```
Started SupermarketApplication in X.XXX seconds
```

---

### ✅ 第3步：刷新前端

1. 访问 http://localhost:3000
2. 按 `Ctrl+F5` 强制刷新（清除缓存）
3. 登录：`admin` / `123456`

---

## 🧪 功能测试

### 测试1️⃣：基本设置

**步骤**：
1. 点击右上角头像 → 选择"系统设置"
2. 默认在"基本设置"标签页
3. 修改"系统名称"为：`我的超市管理系统`
4. 修改"系统描述"为：`这是我的毕设项目`
5. 点击"保存设置"按钮

**预期结果**：
- ✅ 显示"保存成功"提示
- ✅ 刷新页面后，首页左上角显示新的系统名称
- ✅ 关于系统页面显示新的描述

**验证数据库**：
```sql
SELECT config_key, config_value 
FROM supermarket_db.system_config 
WHERE config_key IN ('system.name', 'system.description');
```

---

### 测试2️⃣：通知设置

**步骤**：
1. 切换到"通知设置"标签页
2. 关闭"库存预警通知"开关（变为灰色）
3. 点击"保存设置"按钮
4. 返回首页（点击左侧"首页仪表盘"）
5. 点击右上角消息图标

**预期结果**：
- ✅ 显示"保存成功"提示
- ✅ 消息列表中不再显示"库存预警"类型的消息
- ✅ 只显示"订单审核"和"系统公告"类消息

**验证数据库**：
```sql
SELECT user_id, config_key, config_value 
FROM supermarket_db.user_config 
WHERE user_id = 1 AND config_key = 'notification.inventory_warning';
```
应该显示 `config_value = 'false'`

**恢复测试**：
1. 返回系统设置 → 通知设置
2. 重新打开"库存预警通知"开关
3. 保存
4. 返回首页查看消息，库存预警消息应该重新出现

---

### 测试3️⃣：安全设置

**步骤**：
1. 切换到"安全设置"标签页
2. 修改"密码过期时间"为 `120` 天
3. 修改"登录失败锁定次数"为 `3` 次
4. 修改"会话超时时间"为 `60` 分钟
5. 关闭"强密码策略"开关
6. 点击"保存设置"按钮

**预期结果**：
- ✅ 显示"保存成功"提示
- ✅ 刷新页面后，修改的值仍然保留

**验证数据库**：
```sql
SELECT config_key, config_value 
FROM supermarket_db.system_config 
WHERE config_key LIKE 'security.%';
```
应该显示：
- `security.password_expire_days = '120'`
- `security.login_fail_times = '3'`
- `security.session_timeout = '60'`
- `security.strong_password = 'false'`

---

### 测试4️⃣：数据导出

**前提**：确保数据库中有商品数据

**步骤**：
1. 切换到"数据设置"标签页
2. 点击"立即导出"按钮
3. 等待下载完成

**预期结果**：
- ✅ 按钮显示"加载中"状态
- ✅ 浏览器自动下载Excel文件
- ✅ 文件名类似：`商品信息_1699999999999.xlsx`
- ✅ 打开Excel文件，能看到完整的商品数据

**Excel内容验证**：
- 表头：商品编号、商品名称、商品分类、单位、成本价、售价、商品描述、状态、创建时间
- 数据行：显示所有商品的详细信息
- 格式：表头有背景色，单元格有边框，商品描述列加宽

---

### 测试5️⃣：关于系统

**步骤**：
1. 切换到"关于系统"标签页
2. 查看显示内容

**预期结果**：
- ✅ 显示系统Logo图标
- ✅ 显示修改后的系统名称（如果修改过）
- ✅ 显示版本号：v1.0.0
- ✅ 显示修改后的系统描述
- ✅ 显示技术栈信息（Vue 3、Spring Boot等）
- ✅ 显示开发团队和许可证信息
- ❌ **不再显示**："查看文档"、"检查更新"、"反馈问题"按钮

---

## 🎯 权限测试

### 测试不同角色的配置

**1. 管理员（admin）**：
- 登录：`admin` / `123456`
- 应该能看到并修改所有设置

**2. 采购员（purchaser）**：
- 登录：`purchaser` / `123456`
- 打开系统设置
- 应该能修改自己的通知设置
- 基本设置、安全设置应该只能查看（需要后续添加权限控制）

**3. 营业员（cashier）**：
- 登录：`cashier` / `123456`
- 打开系统设置
- 应该能修改自己的通知设置
- 基本设置、安全设置应该只能查看（需要后续添加权限控制）

---

## 🔍 常见问题

### Q1：保存后刷新页面，设置没有生效？
**解决**：
1. 打开浏览器开发者工具（F12）
2. 查看 Network 标签
3. 确认 POST `/api/settings` 请求返回 200
4. 清除浏览器缓存：`Ctrl+Shift+Delete`
5. 强制刷新：`Ctrl+F5`

### Q2：导出时提示"导出失败"？
**解决**：
1. 确认后端已重启（加载了Apache POI依赖）
2. 查看后端控制台是否有错误日志
3. 确认数据库中有商品数据：
   ```sql
   SELECT COUNT(*) FROM supermarket_db.product;
   ```
4. 如果没有商品，先添加一些测试商品

### Q3：通知设置保存后，消息列表没有变化？
**解决**：
1. 确认已执行 `system_settings.sql` 脚本
2. 查看数据库中的用户配置：
   ```sql
   SELECT * FROM supermarket_db.user_config WHERE user_id = 1;
   ```
3. 确认消息通知功能已实现（需要与消息通知系统集成）

### Q4：后端启动报错"找不到符号"？
**解决**：
1. 在IDEA中执行：`Maven → Reload Project`
2. 清理并重新编译：
   ```bash
   cd supermarket-backend
   mvn clean compile
   ```
3. 确认所有新创建的Java文件都已保存

---

## ✅ 测试通过标准

- [x] 基本设置能成功保存并在页面显示
- [x] 通知设置开关真实有效
- [x] 安全设置能成功保存到数据库
- [x] 点击导出按钮能下载Excel文件
- [x] Excel文件包含完整的商品数据
- [x] 关于系统页面正确显示系统信息
- [x] 不再显示"外观设置"和"邮件通知"
- [x] 不再显示"数据导入"、"数据备份"、"清理缓存"
- [x] 不再显示"查看文档"、"检查更新"、"反馈问题"按钮

---

## 🎉 测试完成

如果以上测试全部通过，说明系统设置功能已经完全实现！

**下一步**：
1. 添加权限控制（只允许管理员修改系统级配置）
2. 实现操作日志（记录配置修改历史）
3. 在登录、密码修改等功能中应用安全设置
4. 完善通知功能与通知设置的联动

---

有问题请随时反馈！😊

