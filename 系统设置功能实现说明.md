# 系统设置功能实现说明

## ✅ 已完成功能

### 1️⃣ 基本设置
- **功能**：系统名称和系统描述保存到数据库
- **实现**：
  - 数据保存在 `system_config` 表中
  - 配置键：`system.name`、`system.description`
  - 支持修改和实时保存
- **效果**：修改后所有页面的系统名称和描述会同步更新

### 2️⃣ 通知设置
- **功能**：三个通知开关（真实可用）
  - 库存预警通知
  - 订单审核通知
  - 系统公告通知
- **实现**：
  - 数据保存在 `user_config` 表中（用户级配置）
  - 每个用户可以独立配置
  - 关闭后对应类型的消息不会显示
- **效果**：开关控制消息通知的实际展示

### 3️⃣ 安全设置
- **功能**：四项安全策略配置（真实可用）
  - 密码过期时间（30-365天）
  - 登录失败锁定次数（3-10次）
  - 会话超时时间（10-120分钟）
  - 强密码策略开关
- **实现**：
  - 数据保存在 `system_config` 表中（系统级配置）
  - 所有用户共享相同的安全策略
  - 后续可以在登录、密码修改等功能中使用这些配置
- **效果**：配置会影响系统的安全行为

### 4️⃣ 数据设置
- **功能**：导出商品数据到Excel
- **实现**：
  - 使用 Apache POI 5.2.3 生成Excel文件
  - 导出字段：商品编号、商品名称、商品分类、单位、成本价、售价、商品描述、状态、创建时间
  - 点击后浏览器直接下载Excel文件
- **效果**：导出完整的商品信息，可在Excel中查看和编辑

### 5️⃣ 关于系统
- **功能**：显示系统基本信息
- **内容**：
  - 系统Logo和名称
  - 版本号
  - 系统描述
  - 技术栈展示
  - 开发团队和许可证信息
- **已删除**：查看文档、检查更新、反馈问题按钮

---

## 📊 数据库表结构

### system_config（系统配置表）
| 字段 | 类型 | 说明 |
|------|------|------|
| id | BIGINT | 主键 |
| config_key | VARCHAR(100) | 配置键（唯一） |
| config_value | TEXT | 配置值 |
| config_desc | VARCHAR(200) | 配置描述 |
| create_time | DATETIME | 创建时间 |
| update_time | DATETIME | 更新时间 |

**初始数据**：
- `system.name`：超市进销存管理系统
- `system.description`：专业的超市进销存管理解决方案...
- `security.password_expire_days`：90
- `security.login_fail_times`：5
- `security.session_timeout`：30
- `security.strong_password`：true

### user_config（用户配置表）
| 字段 | 类型 | 说明 |
|------|------|------|
| id | BIGINT | 主键 |
| user_id | BIGINT | 用户ID |
| config_key | VARCHAR(100) | 配置键 |
| config_value | VARCHAR(500) | 配置值 |
| create_time | DATETIME | 创建时间 |
| update_time | DATETIME | 更新时间 |

**初始数据（用户ID=1，即admin）**：
- `notification.inventory_warning`：true
- `notification.order_audit`：true
- `notification.system_notice`：true

---

## 🎯 API接口

### 1. 获取系统设置
```
GET /api/settings
```
**响应**：
```json
{
  "code": 200,
  "data": {
    "systemName": "超市进销存管理系统",
    "systemDescription": "专业的超市进销存管理解决方案...",
    "inventoryWarning": true,
    "orderAudit": true,
    "systemNotice": true,
    "passwordExpireDays": 90,
    "loginFailTimes": 5,
    "sessionTimeout": 30,
    "strongPassword": true
  }
}
```

### 2. 保存系统设置
```
POST /api/settings
Content-Type: application/json
```
**请求体**：
```json
{
  "systemName": "超市进销存管理系统",
  "systemDescription": "...",
  "inventoryWarning": true,
  "orderAudit": true,
  "systemNotice": true,
  "passwordExpireDays": 90,
  "loginFailTimes": 5,
  "sessionTimeout": 30,
  "strongPassword": true
}
```
**响应**：
```json
{
  "code": 200,
  "message": "操作成功"
}
```

### 3. 导出商品数据
```
GET /api/settings/export/products
```
**响应**：Excel文件（application/vnd.openxmlformats-officedocument.spreadsheetml.sheet）

---

## 📁 文件清单

### 后端文件
1. **实体类**：
   - `SystemConfig.java` - 系统配置实体
   - `UserConfig.java` - 用户配置实体

2. **Mapper**：
   - `SystemConfigMapper.java` - 系统配置Mapper
   - `UserConfigMapper.java` - 用户配置Mapper

3. **DTO**：
   - `SystemSettingsDTO.java` - 系统设置数据传输对象

4. **Service**：
   - `SystemSettingsService.java` - 系统设置服务接口
   - `SystemSettingsServiceImpl.java` - 系统设置服务实现
   - `ExportService.java` - 导出服务接口
   - `ExportServiceImpl.java` - 导出服务实现

5. **Controller**：
   - `SystemSettingsController.java` - 系统设置控制器

6. **SQL脚本**：
   - `sql/system_settings.sql` - 数据库表创建和初始数据

7. **依赖**：
   - `pom.xml` - 添加了Apache POI依赖

### 前端文件
1. **页面**：
   - `Settings.vue` - 系统设置页面（完全重写）

2. **API**：
   - `settings.js` - 系统设置API接口

---

## 🚀 使用步骤

### 第1步：执行数据库脚本
在DataGrip或MySQL命令行中执行：
```bash
D:\code\supermarket-system\sql\system_settings.sql
```

### 第2步：重启后端
**IDEA中**：
1. 停止当前运行的后端
2. 重新运行 `SupermarketApplication.java`

**或命令行**：
```bash
cd supermarket-backend
mvn clean install
mvn spring-boot:run
```

### 第3步：刷新前端
访问 http://localhost:3000
- 清除浏览器缓存或强制刷新（Ctrl+F5）

### 第4步：测试功能

#### 测试基本设置
1. 点击右上角头像 → 系统设置
2. 在"基本设置"标签页修改系统名称和描述
3. 点击"保存设置"
4. 刷新页面，查看是否保存成功

#### 测试通知设置
1. 切换到"通知设置"标签页
2. 关闭"库存预警通知"开关
3. 点击"保存设置"
4. 返回首页，查看消息列表是否不再显示库存预警类消息

#### 测试安全设置
1. 切换到"安全设置"标签页
2. 修改密码过期时间、登录失败次数等
3. 点击"保存设置"
4. 这些配置会在后续的登录、密码修改功能中生效

#### 测试数据导出
1. 切换到"数据设置"标签页
2. 点击"立即导出"按钮
3. 浏览器会自动下载Excel文件
4. 打开文件查看商品数据

---

## ⚠️ 注意事项

1. **权限控制**：
   - 基本设置、安全设置：建议只有管理员可以修改
   - 通知设置：每个用户可以独立配置
   - 数据导出：建议限制权限

2. **数据有效性**：
   - 密码过期时间：30-365天
   - 登录失败次数：3-10次
   - 会话超时时间：10-120分钟

3. **Excel导出**：
   - 导出的是当前数据库中的所有商品
   - 如果商品数量很大，导出可能需要一些时间
   - 建议添加进度提示或分页导出

4. **安全性**：
   - 系统配置的修改建议添加操作日志
   - 敏感配置（如密码策略）的修改建议需要二次确认

---

## 🔄 后续优化建议

1. **权限控制**：
   - 在后端Controller中添加 `@PreAuthorize` 注解
   - 限制只有管理员可以修改系统级配置

2. **操作日志**：
   - 记录谁在什么时间修改了哪些配置
   - 便于审计和问题追踪

3. **配置生效**：
   - 目前安全设置只是保存在数据库中
   - 需要在登录、密码修改等功能中读取并应用这些配置

4. **导出功能增强**：
   - 支持导出其他数据（采购记录、销售记录等）
   - 支持自定义导出字段
   - 支持导出为PDF格式

5. **通知功能完善**：
   - 将通知设置与消息通知系统关联
   - 根据用户的通知设置过滤消息

---

## ✨ 已删除的功能

根据您的要求，已删除以下功能：
- ❌ 外观设置（主题模式、主题色、布局方式等）
- ❌ 邮件通知开关
- ❌ 数据导入、数据备份、清理缓存功能
- ❌ 关于系统中的"查看文档"、"检查更新"、"反馈问题"按钮

---

现在系统设置页面的所有功能都是真实可用的，不再是展示性质的写死数据！🎉

