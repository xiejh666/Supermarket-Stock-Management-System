# 数据库导入验证指南

导入数据库后，需要验证数据是否完整导入。本指南提供了多种验证方法。

---

## 🚀 快速验证（推荐）

### 方法1：使用验证脚本（自动化）

**在服务器上执行：**

```bash
# 1. 上传验证脚本到服务器
scp 验证数据库导入完整性.sh root@8.136.43.180:/root/

# 2. SSH登录服务器
ssh root@8.136.43.180

# 3. 给脚本添加执行权限
chmod +x /root/验证数据库导入完整性.sh

# 4. 运行验证脚本
/root/验证数据库导入完整性.sh
```

脚本会自动检查：
- ✅ 数据库连接
- ✅ 数据表是否存在
- ✅ 关键表数据量
- ✅ 表结构
- ✅ 数据完整性
- ✅ 外键关系
- ✅ 字符集设置

### 方法2：使用SQL脚本（手动）

**在服务器上执行：**

```bash
# 1. 上传SQL验证脚本
scp 验证数据库完整性.sql root@8.136.43.180:/root/

# 2. SSH登录服务器
ssh root@8.136.43.180

# 3. 执行SQL脚本
mysql -u root -p supermarket < /root/验证数据库完整性.sql
```

或者在MySQL命令行中：

```bash
mysql -u root -p
source /root/验证数据库完整性.sql
```

---

## 📋 手动验证步骤

### 步骤1：检查数据库是否存在

```sql
-- 登录MySQL
mysql -u root -p

-- 查看所有数据库
SHOW DATABASES;

-- 使用数据库
USE supermarket;

-- 查看数据库字符集
SHOW CREATE DATABASE supermarket;
```

**预期结果**：
- 能看到 `supermarket` 数据库
- 字符集应该是 `utf8mb4`

### 步骤2：检查数据表

```sql
-- 查看所有表
SHOW TABLES;

-- 统计表数量
SELECT COUNT(*) AS '表数量' 
FROM information_schema.TABLES 
WHERE TABLE_SCHEMA = 'supermarket';
```

**预期结果**：
- 应该看到15-20个以上的表
- 包括：`sys_user`, `sys_role`, `product`, `category`, `supplier`, `purchase_order`, `sale_order`, `inventory` 等

### 步骤3：检查关键表数据量

```sql
-- 检查各表数据量
SELECT 'sys_user' AS '表名', COUNT(*) AS '记录数' FROM sys_user
UNION ALL
SELECT 'sys_role', COUNT(*) FROM sys_role
UNION ALL
SELECT 'product', COUNT(*) FROM product
UNION ALL
SELECT 'category', COUNT(*) FROM category
UNION ALL
SELECT 'supplier', COUNT(*) FROM supplier
UNION ALL
SELECT 'purchase_order', COUNT(*) FROM purchase_order
UNION ALL
SELECT 'sale_order', COUNT(*) FROM sale_order
UNION ALL
SELECT 'inventory', COUNT(*) FROM inventory
UNION ALL
SELECT 'message_notification', COUNT(*) FROM message_notification;
```

**预期结果**：
- `sys_user`: 至少1条（管理员账户）
- `sys_role`: 至少3条（ADMIN, PURCHASER, CASHIER）
- 其他表可能有0条或多条记录

### 步骤4：检查表结构

```sql
-- 检查用户表结构
DESCRIBE sys_user;

-- 检查商品表结构
DESCRIBE product;

-- 检查订单表结构
DESCRIBE purchase_order;
```

**预期结果**：
- 表结构应该完整
- 字段类型和约束正确

### 步骤5：检查数据内容

```sql
-- 查看用户数据
SELECT id, username, real_name, phone, email, role_id, status 
FROM sys_user 
LIMIT 10;

-- 查看商品数据
SELECT id, product_code, product_name, price, status 
FROM product 
LIMIT 10;

-- 查看角色数据
SELECT id, role_name, role_code, description 
FROM sys_role;
```

**预期结果**：
- 能看到实际数据
- 中文显示正常（无乱码）
- 数据格式正确

### 步骤6：检查数据关联

```sql
-- 检查用户和角色的关联
SELECT u.id, u.username, u.real_name, r.role_name, r.role_code
FROM sys_user u
LEFT JOIN sys_role r ON u.role_id = r.id
LIMIT 10;

-- 检查商品和分类的关联
SELECT p.id, p.product_name, c.category_name
FROM product p
LEFT JOIN category c ON p.category_id = c.id
LIMIT 10;
```

**预期结果**：
- 关联关系正确
- 没有孤立数据

### 步骤7：检查字符集

```sql
-- 检查数据库字符集
SELECT SCHEMA_NAME, DEFAULT_CHARACTER_SET_NAME, DEFAULT_COLLATION_NAME
FROM information_schema.SCHEMATA 
WHERE SCHEMA_NAME = 'supermarket';

-- 检查表字符集
SELECT TABLE_NAME, TABLE_COLLATION
FROM information_schema.TABLES
WHERE TABLE_SCHEMA = 'supermarket';
```

**预期结果**：
- 字符集应该是 `utf8mb4`
- 排序规则应该是 `utf8mb4_unicode_ci` 或 `utf8mb4_general_ci`

---

## ✅ 验证清单

完成以下检查项，确保数据库导入完整：

- [ ] **数据库存在**：`SHOW DATABASES;` 能看到 `supermarket`
- [ ] **表数量正确**：至少有15个以上的表
- [ ] **关键表存在**：`sys_user`, `sys_role`, `product`, `category`, `supplier`, `purchase_order`, `sale_order`, `inventory`
- [ ] **用户数据**：`sys_user` 表至少有1条记录
- [ ] **角色数据**：`sys_role` 表至少有3条记录（ADMIN, PURCHASER, CASHIER）
- [ ] **表结构完整**：关键表的字段都存在
- [ ] **数据关联正常**：用户能关联到角色，商品能关联到分类
- [ ] **字符集正确**：数据库和表都是 `utf8mb4`
- [ ] **中文显示正常**：查询数据时中文无乱码
- [ ] **索引存在**：关键表有主键和索引

---

## 🔍 常见问题排查

### 问题1：表数量为0

**原因**：导入失败或数据库为空

**解决**：
```bash
# 检查导入日志
# 重新导入数据库
mysql -u root -p supermarket < /tmp/supermarket_db_backup.sql
```

### 问题2：数据量为0

**原因**：只导入了表结构，没有导入数据

**解决**：
```bash
# 检查SQL文件是否包含INSERT语句
grep -i "INSERT INTO" /tmp/supermarket_db_backup.sql | head -5

# 如果SQL文件不包含数据，需要重新导出（包含数据）
mysqldump -u root -p --default-character-set=utf8mb4 --databases supermarket_db > backup_with_data.sql
```

### 问题3：中文乱码

**原因**：字符集不正确

**解决**：
```sql
-- 检查并修改数据库字符集
ALTER DATABASE supermarket CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- 修改表的字符集
ALTER TABLE sys_user CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

### 问题4：外键关联失败

**原因**：数据导入顺序问题或外键约束

**解决**：
```sql
-- 检查孤立数据
SELECT COUNT(*) FROM sys_user u 
LEFT JOIN sys_role r ON u.role_id = r.id 
WHERE r.id IS NULL AND u.role_id IS NOT NULL;

-- 如果有关联问题，可能需要临时禁用外键检查后重新导入
SET FOREIGN_KEY_CHECKS = 0;
-- 重新导入数据
SET FOREIGN_KEY_CHECKS = 1;
```

---

## 📊 快速验证命令（一行）

```bash
# 检查表数量和数据量
mysql -u root -p -e "USE supermarket; SELECT COUNT(*) AS '表数量' FROM information_schema.TABLES WHERE TABLE_SCHEMA = 'supermarket'; SELECT 'sys_user' AS '表', COUNT(*) AS '记录数' FROM sys_user UNION ALL SELECT 'product', COUNT(*) FROM product UNION ALL SELECT 'purchase_order', COUNT(*) FROM purchase_order;"
```

---

## 💡 验证完成后

如果所有检查都通过，说明数据库导入成功！接下来可以：

1. **更新应用配置**：确保应用连接到正确的数据库
2. **测试应用功能**：登录系统，测试各个功能模块
3. **备份数据库**：导入成功后，建议立即备份一次

---

## 📞 需要帮助？

如果验证过程中发现问题，请提供：
1. 执行的命令
2. 错误信息
3. 验证脚本的输出结果

