# 商品管理模块快速启动指南

## 🚀 快速开始

### 第一步：执行数据库迁移（必须！）

**在使用商品管理功能前，必须先添加`specification`字段到数据库。**

#### 选项1：使用SQL文件（推荐）
```bash
# 进入项目sql目录
cd d:\code\supermarket-system\sql

# 执行迁移脚本
mysql -u root -p supermarket < add-product-specification.sql
```

#### 选项2：手动执行SQL
1. 打开MySQL客户端或Navicat等工具
2. 连接到数据库
3. 选择`supermarket`数据库
4. 执行以下SQL：

```sql
ALTER TABLE `product` ADD COLUMN `specification` VARCHAR(50) DEFAULT NULL COMMENT '规格' AFTER `unit`;
```

### 第二步：修改Entity配置

执行完SQL后，需要修改`Product.java`实体类：

**文件位置**: `supermarket-backend/src/main/java/com/supermarket/entity/Product.java`

**修改内容**:
```java
// 将这一行：
@TableField(value = "specification", exist = false)

// 改为：
// @TableField(value = "specification", exist = false)  // 已执行SQL迁移，注释此行
```

或者直接改为：
```java
private String specification;
```

### 第三步：重新编译并启动

```bash
# 进入后端目录
cd d:\code\supermarket-system\supermarket-backend

# 重新编译
mvn clean compile

# 启动后端服务
mvn spring-boot:run
```

### 第四步：启动前端

```bash
# 进入前端目录
cd d:\code\supermarket-system\supermarket-frontend

# 启动前端服务
npm run dev
```

## ✅ 验证修复

### 1. 验证侧边栏菜单
- 登录系统
- 点击左侧"商品管理"菜单
- 应该能看到下拉选项：
  - 分类管理
  - 商品管理

### 2. 验证新增商品
- 进入商品管理页面
- 点击"新增商品"按钮
- 填写表单：
  - 商品名称：测试商品
  - 商品编码：TEST001
  - 商品分类：选择任意分类
  - 规格：500ml（新增字段）
  - 单位：瓶
  - 成本价：10.00
  - **零售价：15.00**（重点测试）
  - 预警库存：10
- 点击"确定"
- **应该能成功创建，不再提示"零售价不能为空"**

### 3. 验证列表显示
- 查看商品列表
- 确认以下列都正确显示：
  - ✅ 商品编码
  - ✅ 商品名称
  - ✅ 规格（新增）
  - ✅ 单位
  - ✅ 成本价
  - ✅ **零售价**（之前不显示，现在应该显示）
  - ✅ 库存
  - ✅ 状态

## 📋 字段说明

### 数据库字段 vs 前端字段

| 数据库字段 | 字段含义 | 前端使用字段 | 说明 |
|-----------|---------|-------------|------|
| `price` | **零售价**（售价） | `retailPrice` | 商品的销售价格 |
| `cost_price` | **成本价** | `costPrice` | 商品的采购成本 |
| `specification` | **规格** | `specification` | 如"500ml"、"1kg"等 |
| `image` | 商品图片 | `imageUrl` | 图片URL地址 |

**重要提示**：
- 数据库中`price`字段存储的是**零售价**（不是成本价！）
- 前端统一使用`retailPrice`来表示零售价
- 后端Service层会自动进行字段映射

## 🔧 常见问题

### Q1: 执行SQL后仍然报错？
**A**: 需要重启后端服务。执行SQL后，Spring Boot不会自动检测到表结构变化。

### Q2: 零售价还是不显示？
**A**: 检查以下几点：
1. 数据库中`price`字段是否有数据
2. 后端Service层是否正确映射了`price`到`retailPrice`
3. 前端表格列是否使用`retailPrice`字段
4. 清除浏览器缓存并刷新页面

### Q3: 新增商品时提示"零售价不能为空"？
**A**: 检查：
1. 表单中是否填写了零售价
2. 零售价输入框是否绑定了`form.retailPrice`
3. 后端DTO是否包含`retailPrice`字段
4. 后端Service是否将`retailPrice`映射到`price`

### Q4: specification字段是必填的吗？
**A**: 不是必填的。规格字段可以为空，但建议填写以便更好地描述商品。

## 📝 测试数据示例

可以使用以下数据进行测试：

```
商品1：
- 商品名称：可口可乐
- 商品编码：COLA001
- 分类：食品饮料
- 规格：500ml
- 单位：瓶
- 成本价：2.50
- 零售价：3.50
- 预警库存：50

商品2：
- 商品名称：康师傅方便面
- 商品编码：NOODLE001
- 分类：食品饮料
- 规格：5连包
- 单位：包
- 成本价：8.00
- 零售价：12.00
- 预警库存：30
```

## 🎯 修复总结

本次修复解决了以下问题：

1. ✅ **侧边栏子菜单显示空白** - 修改了`el-sub-menu`的index避免冲突
2. ✅ **新增商品零售价验证失败** - 添加了字段映射逻辑
3. ✅ **商品列表不显示零售价** - Service层自动映射`price`到`retailPrice`
4. ✅ **添加规格字段支持** - 提供了SQL迁移脚本

## 📞 需要帮助？

如果遇到问题，请检查：
1. 数据库迁移是否成功执行
2. 后端服务是否重启
3. 浏览器控制台是否有错误信息
4. 后端日志是否有异常

---

**最后更新**: 2025-11-17
**版本**: v1.0
