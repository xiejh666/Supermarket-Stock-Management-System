# SQLæ–‡ä»¶ç¼–ç é”™è¯¯å¿«é€Ÿä¿®å¤æŒ‡å—

## âŒ é”™è¯¯ç°è±¡

å¯¼å…¥æ•°æ®åº“æ—¶å‡ºç°ä»¥ä¸‹é”™è¯¯ï¼š
```
ERROR: ASCII '\0' appeared in the statement, but this is not allowed unless option --binary-mode is enabled and mysql is run in non-interactive mode.
Set --binary-mode to 1 if ASCII '\0' is expected.
Query: 'Ã¿Ã¾-'.
```

## ğŸ” é—®é¢˜åŸå› 

**æ ¹æœ¬åŸå› **ï¼šSQLæ–‡ä»¶ç¼–ç ä¸æ­£ç¡®
- `Ã¿Ã¾` æ˜¯UTF-16 Little Endiançš„BOMï¼ˆå­—èŠ‚é¡ºåºæ ‡è®°ï¼‰
- MySQLéœ€è¦UTF-8ç¼–ç çš„SQLæ–‡ä»¶
- Windowså¯¼å‡ºçš„æ–‡ä»¶å¯èƒ½ä½¿ç”¨äº†UTF-16ç¼–ç 

## âœ… è§£å†³æ–¹æ¡ˆï¼ˆæŒ‰ä¼˜å…ˆçº§ï¼‰

### æ–¹æ¡ˆ1ï¼šé‡æ–°å¯¼å‡ºï¼ˆæœ€æ¨èï¼‰â­

**åœ¨Windowsä¸Šé‡æ–°å¯¼å‡ºï¼Œä½¿ç”¨æ­£ç¡®çš„å‘½ä»¤ï¼š**

```bash
# 1. æ‰“å¼€CMDæˆ–PowerShell
# 2. è®¾ç½®UTF-8ç¼–ç 
chcp 65001

# 3. ä½¿ç”¨æ­£ç¡®çš„å‚æ•°å¯¼å‡º
mysqldump -u root -p --default-character-set=utf8mb4 --set-charset --databases supermarket_db > supermarket_db_backup.sql
```

**å…³é”®å‚æ•°è¯´æ˜**ï¼š
- `chcp 65001`ï¼šè®¾ç½®å‘½ä»¤è¡Œç¼–ç ä¸ºUTF-8
- `--default-character-set=utf8mb4`ï¼šæŒ‡å®šå­—ç¬¦é›†
- `--set-charset`ï¼šåœ¨SQLæ–‡ä»¶ä¸­æ·»åŠ SET NAMESè¯­å¥
- `--databases`ï¼šåŒ…å«CREATE DATABASEè¯­å¥

### æ–¹æ¡ˆ2ï¼šåœ¨æœåŠ¡å™¨ä¸Šè½¬æ¢æ–‡ä»¶ç¼–ç 

**å¦‚æœæ–‡ä»¶å·²ç»ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œå¯ä»¥è½¬æ¢ç¼–ç ï¼š**

```bash
# 1. ä¸Šä¼ ä¿®å¤è„šæœ¬åˆ°æœåŠ¡å™¨
scp ä¿®å¤SQLæ–‡ä»¶ç¼–ç .sh root@8.136.43.180:/root/

# 2. SSHç™»å½•æœåŠ¡å™¨
ssh root@8.136.43.180

# 3. ç»™è„šæœ¬æ·»åŠ æ‰§è¡Œæƒé™
chmod +x /root/ä¿®å¤SQLæ–‡ä»¶ç¼–ç .sh

# 4. è¿è¡Œä¿®å¤è„šæœ¬
/root/ä¿®å¤SQLæ–‡ä»¶ç¼–ç .sh /tmp/supermarket_db_backup2.sql

# 5. å¯¼å…¥ä¿®å¤åçš„æ–‡ä»¶
mysql -u root -p supermarket < /tmp/supermarket_db_backup2_utf8.sql
```

**æˆ–è€…æ‰‹åŠ¨è½¬æ¢ï¼š**

```bash
# æ£€æŸ¥æ–‡ä»¶ç¼–ç 
file /tmp/supermarket_db_backup2.sql

# è½¬æ¢UTF-16 LEåˆ°UTF-8
iconv -f UTF-16LE -t UTF-8 /tmp/supermarket_db_backup2.sql > /tmp/supermarket_db_backup2_utf8.sql

# å¯¼å…¥è½¬æ¢åçš„æ–‡ä»¶
mysql -u root -p supermarket < /tmp/supermarket_db_backup2_utf8.sql
```

### æ–¹æ¡ˆ3ï¼šä½¿ç”¨MySQL Workbenchå¯¼å‡ºï¼ˆå›¾å½¢åŒ–ï¼‰

1. æ‰“å¼€ **MySQL Workbench**
2. è¿æ¥åˆ°æœ¬åœ°æ•°æ®åº“
3. ç‚¹å‡»èœå•ï¼š**Server** â†’ **Data Export**
4. é€‰æ‹©æ•°æ®åº“å’Œè¡¨
5. **é‡è¦**ï¼šåœ¨"Export Options"ä¸­ï¼š
   - âœ… é€‰æ‹© "Export to Self-Contained File"
   - âœ… å‹¾é€‰ "Include Create Schema"
   - âœ… åœ¨"Advanced Options"ä¸­ç¡®ä¿ç¼–ç ä¸ºUTF-8
6. ç‚¹å‡» **Start Export**
7. ä¸Šä¼ å¯¼å‡ºçš„æ–‡ä»¶åˆ°æœåŠ¡å™¨å¹¶å¯¼å…¥

### æ–¹æ¡ˆ4ï¼šä¸´æ—¶è§£å†³æ–¹æ¡ˆï¼ˆä¸æ¨èï¼‰

```bash
# ä½¿ç”¨--binary-modeå¯¼å…¥ï¼ˆå¯èƒ½ä»æœ‰é—®é¢˜ï¼‰
mysql -u root -p --binary-mode supermarket < /tmp/supermarket_db_backup2.sql
```

âš ï¸ **æ³¨æ„**ï¼šè¿™ä¸ªæ–¹æ³•å¯èƒ½æ— æ³•å®Œå…¨è§£å†³é—®é¢˜ï¼Œå»ºè®®ä½¿ç”¨æ–¹æ¡ˆ1æˆ–2ã€‚

## ğŸ”§ æ£€æŸ¥æ–‡ä»¶ç¼–ç çš„æ–¹æ³•

### Windowsä¸Šæ£€æŸ¥

```powershell
# PowerShellä¸­æ£€æŸ¥æ–‡ä»¶ç¼–ç 
Get-Content supermarket_db_backup.sql -Encoding Byte -TotalCount 3 | Format-Hex
```

### LinuxæœåŠ¡å™¨ä¸Šæ£€æŸ¥

```bash
# æ£€æŸ¥æ–‡ä»¶ç¼–ç 
file /tmp/supermarket_db_backup2.sql
file -i /tmp/supermarket_db_backup2.sql

# æŸ¥çœ‹æ–‡ä»¶å‰å‡ ä¸ªå­—èŠ‚ï¼ˆæ£€æŸ¥BOMï¼‰
head -c 10 /tmp/supermarket_db_backup2.sql | od -An -tx1

# BOMæ ‡è®°è¯´æ˜ï¼š
# UTF-8 BOM:    ef bb bf
# UTF-16 LE:    ff fe (è¿™å°±æ˜¯ä½ çœ‹åˆ°çš„Ã¿Ã¾)
# UTF-16 BE:    fe ff
```

## ğŸ“ å®Œæ•´æ“ä½œç¤ºä¾‹

### æ­¥éª¤1ï¼šåœ¨Windowsä¸Šé‡æ–°å¯¼å‡º

```cmd
REM æ‰“å¼€CMD
chcp 65001
cd D:\code\supermarket-system
mysqldump -u root -p --default-character-set=utf8mb4 --set-charset --databases supermarket_db > supermarket_db_backup_utf8.sql
```

### æ­¥éª¤2ï¼šä¸Šä¼ åˆ°æœåŠ¡å™¨

```bash
scp supermarket_db_backup_utf8.sql root@8.136.43.180:/tmp/
```

### æ­¥éª¤3ï¼šåœ¨æœåŠ¡å™¨ä¸Šå¯¼å…¥

```bash
ssh root@8.136.43.180
mysql -u root -p supermarket < /tmp/supermarket_db_backup_utf8.sql
```

## âœ… éªŒè¯å¯¼å…¥æˆåŠŸ

```sql
-- ç™»å½•MySQL
mysql -u root -p

-- ä½¿ç”¨æ•°æ®åº“
USE supermarket;

-- æŸ¥çœ‹æ‰€æœ‰è¡¨
SHOW TABLES;

-- æ£€æŸ¥æ•°æ®é‡
SELECT COUNT(*) FROM sys_user;
SELECT COUNT(*) FROM product;
SELECT COUNT(*) FROM purchase_order;
```

## ğŸ¯ é¢„é˜²æªæ–½

**ä»¥åå¯¼å‡ºæ—¶ï¼Œå§‹ç»ˆä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š**

```bash
# Windows CMD/PowerShell
chcp 65001
mysqldump -u root -p --default-character-set=utf8mb4 --set-charset --databases æ•°æ®åº“å > å¤‡ä»½æ–‡ä»¶.sql
```

**æˆ–è€…ä½¿ç”¨æ›´æ–°åçš„æ‰¹å¤„ç†è„šæœ¬ï¼š**
- åŒå‡»è¿è¡Œ `å¯¼å‡ºå¹¶ä¸Šä¼ æ•°æ®åº“.bat`
- è„šæœ¬å·²è‡ªåŠ¨åŒ…å«æ­£ç¡®çš„ç¼–ç è®¾ç½®

## ğŸ“ å¦‚æœä»ç„¶å¤±è´¥

1. **æ£€æŸ¥MySQLç‰ˆæœ¬**ï¼š`mysql --version`
2. **æ£€æŸ¥æ–‡ä»¶å¤§å°**ï¼šç¡®ä¿æ–‡ä»¶å®Œæ•´
3. **æŸ¥çœ‹è¯¦ç»†é”™è¯¯**ï¼š`mysql -u root -p --verbose supermarket < file.sql`
4. **å°è¯•åˆ†æ®µå¯¼å…¥**ï¼šå¦‚æœæ–‡ä»¶å¾ˆå¤§ï¼Œå¯ä»¥å°è¯•åˆ†æ®µå¯¼å…¥

## ğŸ’¡ å¸¸è§é—®é¢˜

**Q: ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ä¸ªé”™è¯¯ï¼Ÿ**
A: Windowsçš„æŸäº›å·¥å…·ï¼ˆå¦‚è®°äº‹æœ¬ã€æŸäº›ç¼–è¾‘å™¨ï¼‰é»˜è®¤ä½¿ç”¨UTF-16ç¼–ç ä¿å­˜æ–‡ä»¶ï¼Œè€ŒMySQLéœ€è¦UTF-8ç¼–ç ã€‚

**Q: ä½¿ç”¨--binary-modeå¯ä»¥å—ï¼Ÿ**
A: å¯ä»¥ä¸´æ—¶è§£å†³ï¼Œä½†ä¸æ˜¯æœ€ä½³æ–¹æ¡ˆã€‚æœ€å¥½è¿˜æ˜¯è½¬æ¢æ–‡ä»¶ç¼–ç ã€‚

**Q: å¦‚ä½•ç¡®ä¿ä»¥åä¸å†å‡ºç°ï¼Ÿ**
A: ä½¿ç”¨ `chcp 65001` å’Œ `--default-character-set=utf8mb4 --set-charset` å‚æ•°å¯¼å‡ºã€‚

