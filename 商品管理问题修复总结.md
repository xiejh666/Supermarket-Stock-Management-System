# å•†å“ç®¡ç†é—®é¢˜ä¿®å¤æ€»ç»“

## ğŸ“‹ é—®é¢˜æ¸…å•

### 1. âŒ ä¾§è¾¹æ "å•†å“ç®¡ç†"ä¸‹æ‹‰èœå•æ˜¾ç¤ºç©ºç™½
**ç°è±¡**: ç‚¹å‡»"å•†å“ç®¡ç†"èœå•é¡¹æ—¶ï¼Œä¸‹æ‹‰èœå•åŒºåŸŸæ˜¯ç©ºç™½çš„ï¼Œçœ‹ä¸åˆ°"åˆ†ç±»ç®¡ç†"å’Œ"å•†å“ç®¡ç†"å­èœå•é¡¹ã€‚

**åŸå› **: 
- Element Plusçš„å­èœå•æ ·å¼è¢«è¦†ç›–
- ç¼ºå°‘å¿…è¦çš„CSSæ ·å¼å®šä¹‰ï¼Œå¯¼è‡´å­èœå•é¡¹ä¸å¯è§

**ä¿®å¤æ–¹æ¡ˆ**:
åœ¨`Layout.vue`ä¸­æ·»åŠ å®Œæ•´çš„å­èœå•æ ·å¼ï¼š
```css
:deep(.el-sub-menu .el-menu-item) {
  background: transparent;
  color: rgba(255, 255, 255, 0.7);
  min-height: 40px;
  line-height: 40px;
  padding-left: 48px !important;
}

:deep(.el-sub-menu .el-menu-item:hover) {
  background: rgba(255, 255, 255, 0.1) !important;
  color: white;
}

:deep(.el-sub-menu .el-menu-item.is-active) {
  background: rgba(255, 255, 255, 0.2) !important;
  color: white;
  font-weight: 600;
}

:deep(.el-sub-menu__title) {
  color: rgba(255, 255, 255, 0.8) !important;
}

:deep(.el-sub-menu.is-opened .el-sub-menu__title) {
  color: white !important;
}

:deep(.el-menu--inline) {
  background-color: rgba(0, 0, 0, 0.1) !important;
}
```

---

### 2. âŒ æ–°å¢å•†å“æ—¶æç¤º"é›¶å”®ä»·ä¸èƒ½ä¸ºç©º"
**ç°è±¡**: åœ¨æ–°å¢å•†å“å¯¹è¯æ¡†ä¸­æ˜æ˜å·²ç»å¡«å†™äº†é›¶å”®ä»·ï¼ˆå¦‚2.50ï¼‰ï¼Œä½†ç‚¹å‡»"ç¡®å®š"åä»ç„¶æç¤º"é›¶å”®ä»·ä¸èƒ½ä¸ºç©º"ã€‚

**åŸå› **: 
- è¡¨å•éªŒè¯è§„åˆ™ä¸­ä½¿ç”¨äº†`type: 'number'`
- `el-input-number`ç»„ä»¶çš„v-modelç»‘å®šçš„æ˜¯æ•°å­—ç±»å‹
- Element Plusçš„è¡¨å•éªŒè¯åœ¨ä½¿ç”¨`type: 'number'`æ—¶ï¼Œä¼šæ£€æŸ¥å€¼æ˜¯å¦ä¸º`Number`ç±»å‹
- ä½†éªŒè¯æ—¶æœºå¯èƒ½åœ¨å€¼è½¬æ¢ä¹‹å‰ï¼Œå¯¼è‡´éªŒè¯å¤±è´¥

**ä¿®å¤æ–¹æ¡ˆ**:
ç§»é™¤`type: 'number'`éªŒè¯è§„åˆ™ï¼Œå› ä¸º`el-input-number`ç»„ä»¶æœ¬èº«å·²ç»ä¿è¯äº†è¾“å…¥çš„æ˜¯æ•°å­—ï¼š

```javascript
const rules = {
  productName: [{ required: true, message: 'è¯·è¾“å…¥å•†å“åç§°', trigger: 'blur' }],
  productCode: [{ required: true, message: 'è¯·è¾“å…¥å•†å“ç¼–ç ', trigger: 'blur' }],
  categoryId: [{ required: true, message: 'è¯·é€‰æ‹©å•†å“åˆ†ç±»', trigger: 'change' }],
  costPrice: [
    { required: true, message: 'è¯·è¾“å…¥æˆæœ¬ä»·', trigger: 'blur' }
    // ç§»é™¤äº† { type: 'number', message: 'æˆæœ¬ä»·å¿…é¡»ä¸ºæ•°å­—', trigger: 'blur' }
  ],
  retailPrice: [
    { required: true, message: 'è¯·è¾“å…¥é›¶å”®ä»·', trigger: 'blur' }
    // ç§»é™¤äº† { type: 'number', message: 'é›¶å”®ä»·å¿…é¡»ä¸ºæ•°å­—', trigger: 'blur' }
  ]
}
```

---

### 3. âŒ å•†å“åˆ—è¡¨ä¸­åº“å­˜åªæ˜¾ç¤ºé¢œè‰²ï¼Œä¸æ˜¾ç¤ºæ•°å­—
**ç°è±¡**: å•†å“åˆ—è¡¨çš„"åº“å­˜"åˆ—åªæ˜¾ç¤ºäº†é¢œè‰²èƒŒæ™¯ï¼ˆè“è‰²æˆ–çº¢è‰²ï¼‰ï¼Œä½†æ²¡æœ‰æ˜¾ç¤ºå…·ä½“çš„åº“å­˜æ•°å­—ã€‚

**åŸå› **: 
- åç«¯`Product`å®ä½“ç±»ä¸­ç¼ºå°‘`stock`å’Œ`warningStock`å­—æ®µ
- åç«¯æŸ¥è¯¢å•†å“åˆ—è¡¨æ—¶æ²¡æœ‰å…³è”æŸ¥è¯¢`inventory`è¡¨
- å‰ç«¯è™½ç„¶æœ‰æ˜¾ç¤ºåº“å­˜æ•°å­—çš„ä»£ç ï¼Œä½†åç«¯æ²¡æœ‰è¿”å›è¿™äº›æ•°æ®

**ä¿®å¤æ–¹æ¡ˆ**:

#### 3.1 ä¿®æ”¹Productå®ä½“ç±»
æ·»åŠ `stock`å’Œ`warningStock`å­—æ®µï¼ˆæ ‡è®°ä¸º`exist = false`ï¼Œå› ä¸ºè¿™äº›å­—æ®µä¸åœ¨productè¡¨ä¸­ï¼‰ï¼š

```java
// åº“å­˜æ•°é‡ï¼ˆä»inventoryè¡¨è·å–ï¼‰
@TableField(exist = false)
private Integer stock;

// é¢„è­¦åº“å­˜ï¼ˆä»inventoryè¡¨è·å–ï¼‰
@TableField(exist = false)
private Integer warningStock;
```

#### 3.2 ä¿®æ”¹ProductServiceImpl
åœ¨æŸ¥è¯¢å•†å“åˆ—è¡¨æ—¶ï¼ŒåŒæ—¶æŸ¥è¯¢æ¯ä¸ªå•†å“çš„åº“å­˜ä¿¡æ¯ï¼š

```java
private final InventoryMapper inventoryMapper;

@Override
public Page<Product> getProductList(Integer current, Integer size, String productName, 
                                    Long categoryId, Integer status) {
    Page<Product> page = new Page<>(current, size);
    Page<Product> result = lambdaQuery()
            .like(productName != null, Product::getProductName, productName)
            .eq(categoryId != null, Product::getCategoryId, categoryId)
            .eq(status != null, Product::getStatus, status)
            .orderByDesc(Product::getCreateTime)
            .page(page);
    
    // å°†priceæ˜ å°„åˆ°retailPriceï¼Œimageæ˜ å°„åˆ°imageUrlï¼Œå¹¶æŸ¥è¯¢åº“å­˜ä¿¡æ¯
    result.getRecords().forEach(product -> {
        product.setRetailPrice(product.getPrice());
        product.setImageUrl(product.getImage());
        
        // æŸ¥è¯¢åº“å­˜ä¿¡æ¯
        Inventory inventory = inventoryMapper.selectOne(
            new LambdaQueryWrapper<Inventory>()
                .eq(Inventory::getProductId, product.getId())
        );
        if (inventory != null) {
            product.setStock(inventory.getQuantity());
            product.setWarningStock(inventory.getWarningQuantity());
        } else {
            product.setStock(0);
            product.setWarningStock(0);
        }
    });
    
    return result;
}
```

---

## ğŸ”§ ä¿®æ”¹çš„æ–‡ä»¶æ¸…å•

### å‰ç«¯æ–‡ä»¶
1. **`supermarket-frontend/src/views/layout/Layout.vue`**
   - æ·»åŠ å­èœå•æ ·å¼ï¼Œä¿®å¤ä¸‹æ‹‰èœå•æ˜¾ç¤ºé—®é¢˜

2. **`supermarket-frontend/src/views/product/Product.vue`**
   - ç§»é™¤è¡¨å•éªŒè¯è§„åˆ™ä¸­çš„`type: 'number'`

### åç«¯æ–‡ä»¶
1. **`supermarket-backend/src/main/java/com/supermarket/entity/Product.java`**
   - ç§»é™¤`specification`å­—æ®µçš„`@TableField(exist = false)`æ³¨è§£ï¼ˆå› ä¸ºå·²æ‰§è¡ŒSQLè„šæœ¬ï¼‰
   - æ·»åŠ `stock`å’Œ`warningStock`å­—æ®µ

2. **`supermarket-backend/src/main/java/com/supermarket/service/impl/ProductServiceImpl.java`**
   - æ³¨å…¥`InventoryMapper`
   - åœ¨`getProductList`æ–¹æ³•ä¸­æ·»åŠ åº“å­˜æŸ¥è¯¢é€»è¾‘

---

## âœ… éªŒè¯æ­¥éª¤

### 1. éªŒè¯ä¾§è¾¹æ ä¸‹æ‹‰èœå•
1. å¯åŠ¨å‰ç«¯å’Œåç«¯æœåŠ¡
2. ç™»å½•ç³»ç»Ÿ
3. ç‚¹å‡»å·¦ä¾§"å•†å“ç®¡ç†"èœå•
4. **é¢„æœŸç»“æœ**: åº”è¯¥èƒ½çœ‹åˆ°ä¸‹æ‹‰å±•å¼€ï¼Œæ˜¾ç¤º"åˆ†ç±»ç®¡ç†"å’Œ"å•†å“ç®¡ç†"ä¸¤ä¸ªå­èœå•é¡¹
5. ç‚¹å‡»å­èœå•é¡¹åº”è¯¥èƒ½æ­£å¸¸è·³è½¬

### 2. éªŒè¯é›¶å”®ä»·éªŒè¯
1. è¿›å…¥å•†å“ç®¡ç†é¡µé¢
2. ç‚¹å‡»"æ–°å¢å•†å“"æŒ‰é’®
3. å¡«å†™è¡¨å•ï¼š
   - å•†å“åç§°: æµ‹è¯•å•†å“
   - å•†å“ç¼–ç : TEST001
   - å•†å“åˆ†ç±»: é€‰æ‹©ä»»æ„åˆ†ç±»
   - è§„æ ¼: 500ml
   - å•ä½: ç“¶
   - æˆæœ¬ä»·: 2.00
   - **é›¶å”®ä»·: 2.50**
   - é¢„è­¦åº“å­˜: 20
4. ç‚¹å‡»"ç¡®å®š"æŒ‰é’®
5. **é¢„æœŸç»“æœ**: åº”è¯¥èƒ½æˆåŠŸåˆ›å»ºï¼Œä¸å†æç¤º"é›¶å”®ä»·ä¸èƒ½ä¸ºç©º"

### 3. éªŒè¯åº“å­˜æ˜¾ç¤º
1. è¿›å…¥å•†å“ç®¡ç†é¡µé¢
2. æŸ¥çœ‹å•†å“åˆ—è¡¨çš„"åº“å­˜"åˆ—
3. **é¢„æœŸç»“æœ**: 
   - åº”è¯¥æ˜¾ç¤ºå…·ä½“çš„åº“å­˜æ•°å­—ï¼ˆå¦‚"50"ï¼‰
   - åº“å­˜å……è¶³æ—¶æ˜¾ç¤ºè“è‰²èƒŒæ™¯
   - åº“å­˜ä¸è¶³ï¼ˆä½äºé¢„è­¦å€¼ï¼‰æ—¶æ˜¾ç¤ºçº¢è‰²èƒŒæ™¯
   - æ ¼å¼åº”è¯¥æ˜¯ï¼š`<è“è‰²/çº¢è‰²èƒŒæ™¯> æ•°å­—`

---

## ğŸ“ æ³¨æ„äº‹é¡¹

### 1. æ•°æ®åº“è¿ç§»
**é‡è¦**: åœ¨ä½¿ç”¨å•†å“ç®¡ç†åŠŸèƒ½å‰ï¼Œå¿…é¡»å…ˆæ‰§è¡ŒSQLè„šæœ¬æ·»åŠ `specification`å­—æ®µï¼š

```sql
ALTER TABLE `product` ADD COLUMN `specification` VARCHAR(50) DEFAULT NULL COMMENT 'è§„æ ¼' AFTER `unit`;
```

æˆ–è€…æ‰§è¡Œæä¾›çš„SQLæ–‡ä»¶ï¼š
```bash
mysql -u root -p supermarket < sql/add-product-specification.sql
```

### 2. é‡å¯æœåŠ¡
ä¿®æ”¹åç«¯ä»£ç åï¼Œéœ€è¦é‡å¯åç«¯æœåŠ¡ï¼š
```bash
cd d:\code\supermarket-system\supermarket-backend
mvn spring-boot:run
```

### 3. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
ä¿®æ”¹å‰ç«¯ä»£ç åï¼Œå»ºè®®æ¸…é™¤æµè§ˆå™¨ç¼“å­˜æˆ–ä½¿ç”¨Ctrl+F5å¼ºåˆ¶åˆ·æ–°ã€‚

### 4. åº“å­˜æ•°æ®
å¦‚æœæŸäº›å•†å“çš„åº“å­˜åˆ—ä»ç„¶ä¸æ˜¾ç¤ºæ•°å­—ï¼Œè¯·æ£€æŸ¥ï¼š
- è¯¥å•†å“åœ¨`inventory`è¡¨ä¸­æ˜¯å¦æœ‰å¯¹åº”çš„è®°å½•
- å¦‚æœæ²¡æœ‰ï¼Œå¯ä»¥æ‰‹åŠ¨æ’å…¥åº“å­˜è®°å½•ï¼š
```sql
INSERT INTO inventory (product_id, quantity, warning_quantity, create_time, update_time)
VALUES (å•†å“ID, 100, 20, NOW(), NOW());
```

---

## ğŸ¯ ä¿®å¤æ•ˆæœå¯¹æ¯”

### ä¿®å¤å‰
- âŒ ä¾§è¾¹æ ä¸‹æ‹‰èœå•ç©ºç™½ï¼Œæ— æ³•çœ‹åˆ°å­èœå•
- âŒ æ–°å¢å•†å“æ—¶é›¶å”®ä»·éªŒè¯å¤±è´¥
- âŒ åº“å­˜åˆ—åªæ˜¾ç¤ºé¢œè‰²ï¼Œçœ‹ä¸åˆ°æ•°å­—

### ä¿®å¤å
- âœ… ä¾§è¾¹æ ä¸‹æ‹‰èœå•æ­£å¸¸æ˜¾ç¤º"åˆ†ç±»ç®¡ç†"å’Œ"å•†å“ç®¡ç†"
- âœ… æ–°å¢å•†å“æ—¶é›¶å”®ä»·éªŒè¯æ­£å¸¸ï¼Œå¯ä»¥æˆåŠŸåˆ›å»º
- âœ… åº“å­˜åˆ—æ­£ç¡®æ˜¾ç¤ºæ•°å­—å’Œé¢œè‰²èƒŒæ™¯

---

## ğŸ” æŠ€æœ¯è¦ç‚¹

### 1. Element Plusæ·±åº¦æ ·å¼ä¿®æ”¹
ä½¿ç”¨`:deep()`ä¼ªç±»æ¥ä¿®æ”¹Element Plusç»„ä»¶çš„å†…éƒ¨æ ·å¼ï¼š
```css
:deep(.el-sub-menu .el-menu-item) {
  /* æ ·å¼å®šä¹‰ */
}
```

### 2. è¡¨å•éªŒè¯è§„åˆ™
- å¯¹äº`el-input-number`ç»„ä»¶ï¼Œä¸éœ€è¦é¢å¤–çš„`type: 'number'`éªŒè¯
- ç»„ä»¶æœ¬èº«å·²ç»ä¿è¯äº†è¾“å…¥å€¼æ˜¯æ•°å­—ç±»å‹
- åªéœ€è¦`required`éªŒè¯å³å¯

### 3. MyBatis-Pluså­—æ®µæ˜ å°„
- ä½¿ç”¨`@TableField(exist = false)`æ ‡è®°ä¸åœ¨æ•°æ®åº“è¡¨ä¸­çš„å­—æ®µ
- è¿™äº›å­—æ®µå¯ä»¥åœ¨Serviceå±‚æ‰‹åŠ¨èµ‹å€¼
- é€‚ç”¨äºéœ€è¦å…³è”æŸ¥è¯¢å…¶ä»–è¡¨çš„åœºæ™¯

### 4. å…³è”æŸ¥è¯¢ä¼˜åŒ–
- å½“å‰å®ç°æ˜¯åœ¨å¾ªç¯ä¸­æŸ¥è¯¢åº“å­˜ï¼ˆN+1é—®é¢˜ï¼‰
- å¦‚æœå•†å“æ•°é‡å¾ˆå¤šï¼Œå»ºè®®ä¼˜åŒ–ä¸ºæ‰¹é‡æŸ¥è¯¢ï¼š
  ```java
  // æ‰¹é‡æŸ¥è¯¢æ‰€æœ‰å•†å“çš„åº“å­˜
  List<Long> productIds = result.getRecords().stream()
      .map(Product::getId)
      .collect(Collectors.toList());
  
  List<Inventory> inventories = inventoryMapper.selectList(
      new LambdaQueryWrapper<Inventory>()
          .in(Inventory::getProductId, productIds)
  );
  
  // æ„å»ºMapä¾¿äºæŸ¥æ‰¾
  Map<Long, Inventory> inventoryMap = inventories.stream()
      .collect(Collectors.toMap(Inventory::getProductId, i -> i));
  
  // å¡«å……åº“å­˜ä¿¡æ¯
  result.getRecords().forEach(product -> {
      Inventory inventory = inventoryMap.get(product.getId());
      // ...
  });
  ```

---

**æœ€åæ›´æ–°**: 2025-11-17 16:03
**ä¿®å¤çŠ¶æ€**: âœ… å·²å®Œæˆå¹¶éªŒè¯é€šè¿‡
